generator client {
  provider = "prisma-client-js"
  output   = "../generated"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

/// A comprehensive classification for products, covering Consumer, Industrial, Digital, and Service categories.
enum ProductType {
  DEFAULT

  /**
   * Goods purchased frequently, immediately, and with minimal comparison effort.
   * Examples: Milk, Bread, Standard Groceries, Basic OTC Drugs.
   */
  CONVENIENCE

  /**
   * Goods where the consumer spends significant time comparing quality, price, style, and features.
   * Examples: Apparel, Electronics (TVs, Laptops), Furniture, Cars.
   */
  SHOPPING

  /**
   * Goods with unique characteristics or strong brand identification; buyers make a special purchase effort.
   * Examples: Luxury Goods, Collectibles, Specific Designer Brands.
   */
  SPECIALTY

  /**
   * Goods the consumer does not normally seek out or even know they need until an event occurs.
   * Examples: Life Insurance, Funeral Services, Smoke Detectors.
   */
  UNSOUGHT

  /**
   * Products that are intangible, inseparable (produced and consumed simultaneously), variable, and perishable.
   * Examples: Haircuts, Consulting, Healthcare, Financial Advice.
   */
  SERVICE_PROFESSIONAL

  /**
   * Services provided on an ongoing, subscription-based model.
   * Examples: Gym Memberships, Streaming Services (Netflix, Spotify), SaaS platforms.
   */
  SERVICE_SUBSCRIPTION

  /**
   * Non-physical products distributed electronically.
   * Examples: E-books, Software Licenses, Downloadable Music/Movies, Digital Art.
   */
  DIGITAL_GOODS

  /**
   * Products based on access to data, specialized knowledge, or training.
   * Examples: Online Courses, Premium News Content, Research Reports, Market Data APIs.
   */
  DIGITAL_INFORMATION

  /**
   * Items that become a part of the final product. Includes raw materials and manufactured parts.
   * Examples: Wheat, Crude Oil (Raw), Steel Sheets, Tires (Parts).
   */
  INDUSTRIAL_MATERIALS

  /**
   * Long-lasting goods that aid in the production process or operations (non-portable, large cost).
   * Examples: Buildings, Heavy Machinery, Conveyor Systems, Manufacturing Plants.
   */
  INDUSTRIAL_CAPITAL_INSTALLATIONS

  /**
   * Supplies and services needed to operate a business (low-cost, short-lived).
   * Examples: Office Supplies (Paper, Pens), Maintenance Services, Lubricants, Cleaning Supplies.
   */
  INDUSTRIAL_SUPPLIES_OPERATIONS
}

model Store {
  id        Int       @id @default(autoincrement())
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
  updatedBy String?
  readonly  Boolean   @default(false)

  name        String  @unique @db.VarChar(255)
  slug        String  @default(uuid(7))
  description String? @db.VarChar(2000)

  quantities    Quantity[]
  serialNumbers SerialNumber[]
}

model Category {
  id        Int       @id @default(autoincrement())
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
  updatedBy String?
  readonly  Boolean   @default(false)

  parentId    Int?
  name        String  @unique @db.VarChar(255)
  slug        String  @default(uuid(7))
  description String? @db.VarChar(2000)

  parent   Category?  @relation("Categories", fields: [parentId], references: [id], onDelete: SetNull, onUpdate: Cascade)
  children Category[] @relation("Categories")
  products Product[]
}

model Tag {
  id        Int       @id @default(autoincrement())
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
  updatedBy String?
  readonly  Boolean   @default(false)

  name        String  @unique @db.VarChar(255)
  slug        String  @default(uuid(7))
  description String? @db.VarChar(2000)

  productTags ProductTag[]
}

model ProductTag {
  id        Int       @id @default(autoincrement())
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
  updatedBy String?
  readonly  Boolean   @default(false)

  productId Int
  tagId     Int

  product Product @relation(fields: [productId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  tag     Tag     @relation(fields: [tagId], references: [id], onDelete: Cascade, onUpdate: Cascade)
}

model Manufacturer {
  id        Int       @id @default(autoincrement())
  uuid      String    @unique @default(uuid(7))
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
  updatedBy String?

  name String @unique @db.VarChar(255)

  products Product[]
}

model Product {
  id        Int       @id @default(autoincrement())
  uuid      String    @unique @default(uuid(7))
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
  updatedBy String?
  readonly  Boolean   @default(false)

  parentId       Int?
  categoryId     Int?
  manufacturerId Int?
  name           String        @unique @db.VarChar(255)
  slug           String        @default(uuid(7))
  model          String?       @db.VarChar(255)
  description    String?       @db.VarChar(2000)
  upc            String        @unique
  sku            String        @unique
  active         Boolean       @default(true)
  type           ProductType   @default(DEFAULT)
  types          ProductType[] @default([DEFAULT])

  parent        Product?       @relation("Variants", fields: [parentId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  category      Category?      @relation(fields: [categoryId], references: [id], onDelete: SetDefault, onUpdate: Cascade)
  manufacturer  Manufacturer?  @relation(fields: [manufacturerId], references: [id])
  variants      Product[]      @relation("Variants")
  productTags   ProductTag[]
  prices        Price[]
  quantities    Quantity[]
  serialNumbers SerialNumber[]
}

model PriceLevel {
  id        Int       @id @default(autoincrement())
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
  updatedBy String?
  readonly  Boolean   @default(false)

  name        String  @unique @db.VarChar(255)
  slug        String  @default(uuid(7))
  description String? @db.VarChar(2000)
  taxrate     Decimal @db.Decimal(3, 2)

  prices Price[]
}

model Price {
  id        Int       @id @default(autoincrement())
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
  updatedBy String?
  readonly  Boolean   @default(false)

  productId    Int
  priceLevelId Int
  price        Decimal @db.Decimal(10, 2)

  product    Product    @relation(fields: [productId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  priceLevel PriceLevel @relation(fields: [priceLevelId], references: [id], onDelete: Cascade, onUpdate: Cascade)
}

model Quantity {
  id        Int       @id @default(autoincrement())
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
  updatedBy String?
  readonly  Boolean   @default(false)

  storeId     Int
  productId   Int
  quantity    Int
  minQuantity Int

  product Product @relation(fields: [productId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  store   Store   @relation(fields: [storeId], references: [id], onDelete: Cascade, onUpdate: Cascade)
}

model SerialNumber {
  id        Int       @id @default(autoincrement())
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
  updatedBy String?
  readonly  Boolean   @default(false)

  storeId      Int
  productId    Int
  serialNumber String  @unique
  inStock      Boolean @default(true)

  product Product @relation(fields: [productId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  store   Store   @relation(fields: [storeId], references: [id], onDelete: Cascade, onUpdate: Cascade)
}
