generator client {
  provider = "prisma-client-js"
  output   = "../generated"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model App {
  id Int @id @default(autoincrement())

  /// Unique app name
  name String @unique

  // App description 
  description String?

  /// App version 
  version String?

  /// Host/IP address
  host String

  /// Port 
  port String

  /// List of app history
  history AppHistory[]

  @@unique([host, port])
}

/// Every month a new encirption secret is introduced
/// Whenever the data is accessed, the encripted data is routed with the new secret lazyly
model Secret {
  id Int @id @default(autoincrement())

  /// The date this encription secret is created
  createdAt DateTime @default(now())

  /// The date this encription secret is updated
  updatedAt DateTime @updatedAt

  /// Version to be used for encription rotations
  version String @default(uuid())

  /// Encripted secret key
  secret String
}

model AppHistory {
  id Int @id @default(autoincrement())

  /// App id
  appId Int

  /// Started at
  startedAt DateTime @default(now())

  /// Stopped at 
  stopeedAt DateTime?

  /// App details
  app App @relation(fields: [appId], references: [id])
}
