generator client {
  provider = "prisma-client-js"
  output   = "../generated"
}

generator zod {
  provider = "zod-generator"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Employee {
  id Int @id @default(autoincrement())

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
  updatedBy Int?
  readonly  Boolean   @default(false)
  active    Boolean   @default(true)

  /// External employee id
  employeeId String @unique

  employee Employee? @relation("createdEmployees", fields: [updatedBy], references: [id], onDelete: SetNull)

  changedStores        Store[]
  changedCategories    Category[]
  changedTags          Tag[]
  changedProductTags   ProductTag[]
  changedSuppliers     Supplier[]
  changedProducts      Product[]
  changedPriceLevels   PriceLevel[]
  changedPrices        Price[]
  changedQuantitys     Quantity[]
  changedSerialNumbers SerialNumber[]
  chagnedImages        Image[]
  chagnedProductImages ProductImage[]
  changedCurrencies    Currency[]
  changedEmployees     Employee[]     @relation("createdEmployees")
}

model Store {
  id        Int       @id @default(autoincrement())
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
  updatedBy Int?
  readonly  Boolean   @default(false)

  /// External store id
  storeId String @unique

  quantities    Quantity[]
  serialNumbers SerialNumber[]
  employee      Employee?      @relation(fields: [updatedBy], references: [id], onDelete: SetNull)
}

model Category {
  id        Int       @id @default(autoincrement())
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
  updatedBy Int?
  readonly  Boolean   @default(false)

  name        String  @unique @db.VarChar(255)
  slug        String  @default(uuid(7))
  description String? @db.VarChar(2000)

  parentId Int?

  parent   Category?  @relation("children", fields: [parentId], references: [id], onDelete: SetNull, onUpdate: Cascade)
  children Category[] @relation("children")
  products Product[]
  employee Employee?  @relation(fields: [updatedBy], references: [id], onDelete: SetNull)

  @@unique([id, name])
}

model Currency {
  id        Int       @id @default(autoincrement())
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
  updatedBy Int?
  readonly  Boolean   @default(false)

  name        String  @unique @db.VarChar(255)
  slug        String  @default(uuid(7))
  symbol      String?
  description String? @db.VarChar(2000)

  employee    Employee?    @relation(fields: [updatedBy], references: [id], onDelete: SetNull)
  priceLevels PriceLevel[]
}

model Tag {
  id        Int       @id @default(autoincrement())
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
  updatedBy Int?
  readonly  Boolean   @default(false)

  name        String  @unique @db.VarChar(255)
  slug        String  @default(uuid(7))
  description String? @db.VarChar(2000)

  productTags ProductTag[]
  employee    Employee?    @relation(fields: [updatedBy], references: [id], onDelete: SetNull)
}

model ProductTag {
  id        Int       @id @default(autoincrement())
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
  updatedBy Int?
  readonly  Boolean   @default(false)

  productId Int
  tagId     Int

  product  Product   @relation(fields: [productId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  tag      Tag       @relation(fields: [tagId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  employee Employee? @relation(fields: [updatedBy], references: [id], onDelete: SetNull)
}

model Supplier {
  id        Int       @id @default(autoincrement())
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
  updatedBy Int?

  /// External uuid 
  supplierId String

  products Product[]
  employee Employee? @relation(fields: [updatedBy], references: [id], onDelete: SetNull)
}

model Product {
  id        Int       @id @default(autoincrement())
  uuid      String    @unique @default(uuid(7))
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
  updatedBy Int?
  readonly  Boolean   @default(false)
  active    Boolean   @default(true)

  name        String  @unique @db.VarChar(255)
  slug        String  @default(uuid(7))
  model       String? @db.VarChar(255)
  description String? @db.VarChar(2000)
  upc         String  @unique
  sku         String  @unique

  parentId   Int?
  categoryId Int?
  supplierId Int?

  parent        Product?       @relation("variants", fields: [parentId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  variants      Product[]      @relation("variants")
  category      Category?      @relation(fields: [categoryId], references: [id], onDelete: SetDefault, onUpdate: Cascade)
  supplier      Supplier?      @relation(fields: [supplierId], references: [id], onDelete: SetNull)
  productTags   ProductTag[]
  prices        Price[]
  quantities    Quantity[]
  serialNumbers SerialNumber[]
  employee      Employee?      @relation(fields: [updatedBy], references: [id], onDelete: SetNull)
  productImages ProductImage[]
}

model Image {
  id        Int       @id @default(autoincrement())
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
  updatedBy Int?

  url         String  @unique
  title       String? @db.VarChar(255)
  description String? @db.VarChar(2000)
  order       Int     @default(0)

  employee      Employee?      @relation(fields: [updatedBy], references: [id])
  productImages ProductImage[]
}

model ProductImage {
  id        Int       @id @default(autoincrement())
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
  updatedBy Int?

  productId Int
  imageId   Int

  product  Product   @relation(fields: [productId], references: [id], onDelete: Cascade)
  image    Image     @relation(fields: [imageId], references: [id], onDelete: Cascade)
  employee Employee? @relation(fields: [updatedBy], references: [id])

  @@unique([productId, imageId])
}

model PriceLevel {
  id        Int       @id @default(autoincrement())
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
  updatedBy Int?
  readonly  Boolean   @default(false)

  name        String  @unique @db.VarChar(255)
  slug        String  @default(uuid(7))
  description String? @db.VarChar(2000)
  taxrate     Decimal @db.Decimal(3, 2)

  currencyId Int

  prices   Price[]
  employee Employee? @relation(fields: [updatedBy], references: [id], onDelete: SetNull)
  currency Currency  @relation(fields: [currencyId], references: [id])
}

model Price {
  id        Int       @id @default(autoincrement())
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
  updatedBy Int?
  readonly  Boolean   @default(false)

  productId    Int
  priceLevelId Int
  price        Decimal @db.Decimal(10, 2)

  product    Product    @relation(fields: [productId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  priceLevel PriceLevel @relation(fields: [priceLevelId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  employee   Employee?  @relation(fields: [updatedBy], references: [id], onDelete: SetNull)
}

model Quantity {
  id        Int       @id @default(autoincrement())
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
  updatedBy Int?
  readonly  Boolean   @default(false)

  storeId     Int
  productId   Int
  quantity    Int
  minQuantity Int?

  product  Product   @relation(fields: [productId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  store    Store     @relation(fields: [storeId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  employee Employee? @relation(fields: [updatedBy], references: [id], onDelete: SetNull)
}

model SerialNumber {
  id        Int       @id @default(autoincrement())
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
  updatedBy Int?
  readonly  Boolean   @default(false)

  serialNumber String  @unique
  inStock      Boolean @default(true)

  storeId   Int
  productId Int

  product  Product   @relation(fields: [productId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  store    Store     @relation(fields: [storeId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  employee Employee? @relation(fields: [updatedBy], references: [id], onDelete: SetNull)
}
